# PRISM K1 Firmware v1.1 Release Notes (Draft)

> Update dates, links, and evidence before publishing the public release.

## Overview

- **Release Date:** <!-- YYYY-MM-DD -->
- **Firmware Tag:** `firmware-v1.1`
- **Tooling Tag:** <!-- git commit hash for tools bundle -->
- **Maintainers:** <!-- Names / handles -->

## Highlights

- **Temporal Sequencing (ADR-010):** Dual-edge motion control with motion directions (`LEFT_ORIGIN`, `RIGHT_ORIGIN`, `CENTER_ORIGIN`, `EDGE_ORIGIN`, `STATIC`) and sync modes (`SYNC`, `OFFSET`, `PROGRESSIVE`, `WAVE`, `CUSTOM`).
- **Preset Library v1.1:** 21 curated patterns spanning sine, noise, and flow engines (`out/presets/`), ready for packaging into distributable `.prism` bundles.
- **Tutorial Series:** Five 10–15 minute videos covering setup, motion directions, sync/shape creation, advanced techniques, and migration/soak validation. (Links TBD)
- **Migration Toolkit:** `tools/migrate_prism.py` upgrades v1.0 assets with default temporal metadata; runbook + playbooks refreshed for v1.1 workflows.
- **Preview & Validation Tooling:** Terminal + HTML previews aligned with temporal defaults, soak telemetry summaries, and updated documentation across `docs/user-manual.md`.

## Breaking Changes

- `.prism` headers updated to v1.1.0 with temporal metadata fields; older firmware cannot parse new payloads.
- Tools default to `ramp_space=hsluv`; install `pip install -r tools/requirements.txt` to ensure colour parity. HSV fallback is available but not recommended for production assets.
- Preset manifests now expect `meta.motion` and `meta.sync` blocks; regenerate or migrate legacy assets before deploying.

## Workflow Summary

| Step | Command | Notes |
| --- | --- | --- |
| Palette / Show Generation | `python3 -m tools.show_to_prism --show <type> --palette ... --ramp-space hsluv` | Deterministic seeds, temporal metadata emitted. |
| Packaging | `python3 -m tools.prism_packaging --input <preset>.json --output <preset>.prism --report <preset>_report.json` | Auto-quantises palettes to ≤64 colours per ADR-010. |
| Library Build | `python3 -m tools.preset_library --output-dir out/presets` | Emits JSON/CSV/PRISM plus quantisation reports. |
| Playlist Schedule | `python3 -m tools.validation.soak_playlist --manifest out/presets/manifest.json --output logs/soak_playlist.csv --dwell-seconds 300 --hours 24` | Generates per-device schedule for soak automation. |
| Telemetry Summary | `python3 -m tools.validation.soak_telemetry --input logs/soak_raw.csv --summary logs/soak_summary.json` | Enforces fragmentation/frame/thermal limits. |
| Migration | `python3 tools/migrate_prism.py <legacy.prism> <migrated.prism>` | Idempotent; adds default temporal metadata. |

## Validation Summary

- **Soak Test:** <!-- Summarise results from docs/release/soak_test_report.md once complete. -->
  - Devices: <!-- dev1/dev2/dev3 -->
  - Metrics: <!-- max fragmentation %, p99 frame time, max temp -->
  - Evidence: `logs/soak_raw.csv`, `logs/soak_summary.json`, `logs/soak_playlist.csv`
- **Preview Compliance:** Terminal + HTML previews match on-device timing across exemplar presets (see `docs/release/preset_library_overview.md`).
- **Firmware Build:** `idf.py build` on ESP-IDF <!-- version --> (attach commit hash, build log).
- **OTA / Rollback:** <!-- Document outcome or note TODO. -->

## Migration Steps

1. **Convert existing assets:** `python3 tools/migrate_prism.py <input.prism> <output.prism>`
2. **Regenerate presets (optional):** Re-run show + palette CLIs for deterministic metadata.
3. **Validate:** `python3 -m tools.validation.prism_sanity --glob "out/**/*.prism"`
4. **Update Documentation:** Replace screenshots, CLI snippets, and manifest references with v1.1 content.

## Assets

- 📦 Preset bundle: `out/presets/` (source) and `out/presets_v1.1.zip` (packaged JSON/CSV/PRISM + reports)
- 🎬 Tutorial playlist: <!-- YouTube playlist link -->
- 📚 User manual: `docs/user-manual.md`
- 🧪 Soak report: `docs/release/soak_test_report.md` (with attachments under `logs/`)
- 📝 Migration playbook: `docs/release/migration_playbook.md`
- 🔁 OTA validation checklist: `docs/release/ota_validation_checklist.md`


## Pending Hardware Validation

- Tutorial video production (Task 20.3) deferred until hardware capture window opens.
- Soak test setup/execution (Tasks 20.4 & 20.5) awaiting hardware availability.
- Final deployment & OTA validation (Task 20.8) blocked on in-lab devices.

## Known Issues / Follow-Ups

- Tutorial video playlist links will be added once recording resumes (hardware dependent).
- Capture OTA upgrade + rollback evidence on three hardware units (Task 20.8).
- Run Markdown link checker (`task-master analyze-complexity`) before publish once hardware evidence is collected.

## Sign-off Checklist

- [ ] Task 20 subtasks 3–8 marked done with evidence attached.
- [ ] Tutorial video links embedded in README and release notes.
- [ ] Soak test artefacts archived and referenced in `docs/release/soak_test_report.md`.
- [x] Preset bundle packaged (`out/presets/`, `out/presets_v1.1.zip`) and checksumed.
- [ ] GitHub release drafted with firmware binaries, preset zip, release notes, and migration guidance.

> Move this file to `docs/release/archive/` with a timestamp after the public release is published.
